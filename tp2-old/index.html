<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Les Travaux Pratiques du cours Urbanisation des Syst√®mes d'Information"><meta name=author content="Lilia Sfaxi"><link href=http://INSATunisia.github.io/TP-Urbanisation/tp2-old/ rel=canonical><link rel=icon href=../img/favicon.ico><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.1.10"><title>Tp2 old - TP Urbanisation des Syst√®mes d'Information</title><link rel=stylesheet href=../assets/stylesheets/main.d6be258b.min.css><link rel=stylesheet href=../assets/stylesheets/palette.e6a45f82.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Questrial:300,400,400i,700%7CSource+Code+Pro&display=fallback"><style>:root{--md-text-font:"Questrial";--md-code-font:"Source Code Pro"}</style><link rel=stylesheet href=../css/timeago.css><link rel=stylesheet href=../stylesheets/extra.css><link rel=stylesheet href=../stylesheets/links.css><link rel=stylesheet href=../stylesheets/custom.css><script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=amber data-md-color-accent=amber> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#telecharger-pdf class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="TP Urbanisation des Syst√®mes d'Information" class="md-header__button md-logo" aria-label="TP Urbanisation des Syst√®mes d'Information" data-md-component=logo> <img src=../img/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> TP Urbanisation des Syst√®mes d'Information </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Tp2 old </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=amber data-md-color-accent=amber aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=amber data-md-color-accent=amber aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/INSATunisia/TP-Urbanisation/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> INSATunisia/TP-Urbanisation </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="TP Urbanisation des Syst√®mes d'Information" class="md-nav__button md-logo" aria-label="TP Urbanisation des Syst√®mes d'Information" data-md-component=logo> <img src=../img/logo.png alt=logo> </a> TP Urbanisation des Syst√®mes d'Information </label> <div class=md-nav__source> <a href=https://github.com/INSATunisia/TP-Urbanisation/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> INSATunisia/TP-Urbanisation </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Travaux Pratiques Urbanisation des SI </a> </li> <li class=md-nav__item> <a href=../projet/ class=md-nav__link> Projet </a> </li> <li class=md-nav__item> <a href=../tp1/ class=md-nav__link> TP1 - Services Web SOAP avec Mule ESB </a> </li> <li class=md-nav__item> <a href=../tp2/ class=md-nav__link> TP2 - REST API Management avec Anypoint Studio </a> </li> <li class=md-nav__item> <a href=../tp3/ class=md-nav__link> TP3 - Orchestration de Services avec Camunda </a> </li> <li class=md-nav__item> <a href=../tp4/ class=md-nav__link> TP4 - Int√©gration BPM et ESB </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#telecharger-pdf class=md-nav__link> T√©l√©charger PDF </a> </li> <li class=md-nav__item> <a href=#objectifs-du-tp class=md-nav__link> Objectifs du TP </a> </li> <li class=md-nav__item> <a href=#outils-et-versions class=md-nav__link> Outils et Versions </a> </li> <li class=md-nav__item> <a href=#configuration-et-utilisation-de-lesb-talend class=md-nav__link> Configuration et Utilisation de l'ESB Talend </a> <nav class=md-nav aria-label="Configuration et Utilisation de l'ESB Talend"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#lancement-de-deux-instances-de-lesb-talend class=md-nav__link> Lancement de deux instances de l'ESB Talend </a> </li> <li class=md-nav__item> <a href=#publier-votre-service-dans-lesb-et-le-tester class=md-nav__link> Publier votre Service dans l'ESB et le Tester </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#creation-des-routes class=md-nav__link> Cr√©ation des Routes </a> <nav class=md-nav aria-label="Cr√©ation des Routes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#premiere-route-filtrage-des-messages class=md-nav__link> Premi√®re Route: Filtrage des Messages </a> </li> <li class=md-nav__item> <a href=#deploiement-des-routes-sur-lesb class=md-nav__link> D√©ploiement des Routes sur l'ESB </a> </li> <li class=md-nav__item> <a href=#deuxieme-route-filtrage-et-modification-de-messages class=md-nav__link> Deuxi√®me Route : Filtrage et Modification de Messages </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fonctionnalites-supplementaires-de-lesb class=md-nav__link> Fonctionnalit√©s Suppl√©mentaires de l'ESB </a> <nav class=md-nav aria-label="Fonctionnalit√©s Suppl√©mentaires de l'ESB"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#failover-et-repartition-de-charge class=md-nav__link> Failover et R√©partition de Charge </a> <nav class=md-nav aria-label="Failover et R√©partition de Charge"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#service-locator class=md-nav__link> Service Locator </a> </li> <li class=md-nav__item> <a href=#configuration-du-service-locator class=md-nav__link> Configuration du Service Locator </a> <nav class=md-nav aria-label="Configuration du Service Locator"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-deploiement-du-sl-dans-le-contenaire class=md-nav__link> 1. D√©ploiement du SL dans le contenaire </a> </li> <li class=md-nav__item> <a href=#2-activer-sl-dans-le-service class=md-nav__link> 2. Activer SL dans le service </a> </li> <li class=md-nav__item> <a href=#3-activer-sl-dans-le-consommateur class=md-nav__link> 3. Activer SL dans le consommateur </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#test-du-service-locator class=md-nav__link> Test du Service Locator </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-monitoring class=md-nav__link> Service Monitoring </a> </li> <li class=md-nav__item> <a href=#authentification class=md-nav__link> Authentification </a> <nav class=md-nav aria-label=Authentification> <ul class=md-nav__list> <li class=md-nav__item> <a href=#security-token-service-sts-implementation-du-ws-trust class=md-nav__link> Security Token Service (STS) : Impl√©mentation du WS-Trust </a> </li> <li class=md-nav__item> <a href=#configuration-des-parametres-de-securite class=md-nav__link> Configuration des Param√®tres de S√©curit√© </a> <nav class=md-nav aria-label="Configuration des Param√®tres de S√©curit√©"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-deployer-sts-dans-le-conteneur-dexecution class=md-nav__link> 1. D√©ployer STS dans le conteneur d‚Äôex√©cution </a> </li> <li class=md-nav__item> <a href=#2-configurer-les-parametres-de-securite-de-votre-conteneur class=md-nav__link> 2. Configurer les param√®tres de s√©curit√© de votre conteneur </a> </li> <li class=md-nav__item> <a href=#3-activer-sts-dans-votre-service class=md-nav__link> 3. Activer STS dans votre service </a> </li> <li class=md-nav__item> <a href=#4-configurer-le-client class=md-nav__link> 4. Configurer le client </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#homework class=md-nav__link> Homework </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/INSATunisia/TP-Urbanisation/edit/master/docs/tp2-old.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>Tp2 old</h1> <p><img alt=ESB src=../img/esb.png></p> <h2 id=telecharger-pdf>T√©l√©charger PDF<a class=headerlink href=#telecharger-pdf title="Permanent link">&para;</a></h2> <p><a href=../tp2.pdf><img alt="Download TP3" src=../img/pdf.png></a></p> <h2 id=objectifs-du-tp>Objectifs du TP<a class=headerlink href=#objectifs-du-tp title="Permanent link">&para;</a></h2> <ol> <li>Routage, m√©diation et transformation avec Talend ESB.</li> <li>Gestion du failover et r√©partition de charges, monitoring et authentification avec Talend ESB.</li> </ol> <h2 id=outils-et-versions>Outils et Versions<a class=headerlink href=#outils-et-versions title="Permanent link">&para;</a></h2> <ul> <li><a href=https://sourceforge.net/projects/talendesb/ >Talend Open Studio for ESB</a> Version: 8.0.1</li> <li><a href=https://dbeaver.io/download/ >DBeaver Community</a> Version 22.2.1</li> </ul> <h2 id=configuration-et-utilisation-de-lesb-talend>Configuration et Utilisation de l'ESB Talend<a class=headerlink href=#configuration-et-utilisation-de-lesb-talend title="Permanent link">&para;</a></h2> <h3 id=lancement-de-deux-instances-de-lesb-talend>Lancement de deux instances de l'ESB Talend<a class=headerlink href=#lancement-de-deux-instances-de-lesb-talend title="Permanent link">&para;</a></h3> <p>Pour les besoins de notre TP, nous allons lancer deux instances de l‚ÄôESB Talend. Pour cela, l‚Äôenvironnement nous fournit une mani√®re tr√®s simple de le faire:</p> <ul> <li>Aller dans le r√©pertoire <em>&lt;rep_install_talend>/Runtime_ESBSE</em></li> <li>Copier le r√©pertoire <em>container</em> et le renommer en <em>alternate-container</em>.</li> </ul> <p>Nous allons maintenant configurer la deuxi√®me instance de l‚ÄôESB (dans <em>alternate-container</em>) pour qu‚Äôelle se lance sur un port diff√©rent de la premi√®re. Pour cela:</p> <ul> <li><strong>Lancer l‚ÄôESB</strong> : dans le r√©pertoire <em>alternate-container</em> que vous venez de cr√©er, aller vers <em>bin</em> et ex√©cuter <em>trun.bash</em> (sur windows). Si vous √™tes sur Linux ou mac, placez-vous sous le r√©pertoire <em>alternate-container/bin</em> et lancer dans un terminal la commande <em>./trun</em>. La fen√™tre suivante devrait s‚Äôafficher:</li> </ul> <p><center><img src=../img/tp3/run-ESB2.png></center></p> <div class="admonition warning"> <p class=admonition-title>Attention</p> <ul> <li>Il faudra peut-√™tre downgrader votre version de Java si vous √™tes sur la 17 (la version recommand√©e ici est la 11).. sorry <img alt=üòÖ class=emojione src=https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f605.svg title=:sweat_smile:></li> <li>Le premier contenaire ne doit pas √™tre en ex√©cution, sinon il y'aura un conflit d'adresses. Il faut d'abord configurer le second contenaire pour qu'il se lance sur un port diff√©rent, ce que nous allons faire dans l'√©tape suivante.</li> </ul> </div> <ul> <li><strong>Configurer l'ESB</strong> : dans l‚Äôinvite de commande affich√©e, taper:</li> </ul> <div class=highlight><pre><span></span><code>  <span class=nb>source</span> scripts/configureC1.sh
</code></pre></div> <ul> <li>Un affichage tel que le suivant va appara√Ætre:</li> </ul> <p><center><img src=../img/tp3/config-ESB2.png></center></p> <p>Vous avez ainsi cr√©√© un ESB, que vous avez configur√© pour se lancer sur le port 8041, alors que, par d√©faut, il devrait se lancer sur le port 8040. Si vous voulez cr√©er une troisi√®me instance, vous pouvez la configurer en utilisant le fichier configureC2.sh, de m√™me pour une quatri√®me instance‚Ä¶ Pour revenir √† la configuration par d√©faut, utiliser configureC0.sh.</p> <ul> <li>Arr√™tez votre ESB, en cliquant sur ctrl-d, et relancez-le de nouveau.</li> <li>Lancez dans un autre terminal l‚Äôinstance de l‚ÄôESB se trouvant sous le r√©pertoire d‚Äôorigine container. Il est inutile de la configurer, elle se lancera par d√©faut sur le port 8040.</li> </ul> <h3 id=publier-votre-service-dans-lesb-et-le-tester>Publier votre Service dans l'ESB et le Tester<a class=headerlink href=#publier-votre-service-dans-lesb-et-le-tester title="Permanent link">&para;</a></h3> <p>Revenir au service web SOAP <a href=../tp1/#service-web-soap-helloworld>HelloWorldService</a> que vous avez cr√©√© dans le TP1, et le publier sur l'ESB. Pour cela, ouvrir l'√©diteur <em>Talend Open Studio</em> sur le projet <em>Helloworld</em>, et suivre les √©tapes suivantes:</p> <ul> <li>Faire un clic-droit sur le service <em>HelloWorldService</em> et choisir <em>Exporter le service</em>. Choisir comme r√©pertoire de destination le dossier <em>deploy</em> se trouvant dans le conteneur o√π vous d√©sirez d√©ployer le service. Un fichier archive de type kar sera alors cr√©√© sous ce r√©pertoire, permettant ainsi son d√©ploiement √† chaud (pas besoin de red√©marrer l‚ÄôESB).</li> <li>D√©ployer votre service sur les deux instances d‚ÄôESB que vous avez d√©marr√©.</li> <li>V√©rifier que vos services sont actifs:<ul> <li>en tapant <em>list</em> dans vos deux instances d‚ÄôESB</li> <li>en affichant les fichiers WSDL du service sur les ports 8040 et 8041 au lieu de 8090.</li> </ul> </li> </ul> <p>Pour tester votre service web:</p> <ul> <li>Dans le job consommateur de service, dans les propri√©t√©s du composant tESBConsumer, modifier le port du endpoint de 8090 √† 8040</li> <li>Lancer votre job. V√©rifier que l‚Äôaffichage se fait correctement sur la console du TOS-ESB.</li> </ul> <p>V√©rifier que votre service s‚Äôex√©cute bien sur l‚ÄôESB principal, en consultant le terminal o√π il est d√©marr√©. Vous devriez trouver un affichage semblable √† celui-ci:</p> <p><center><img src=../img/tp3/service-exec.png></center></p> <h2 id=creation-des-routes>Cr√©ation des Routes<a class=headerlink href=#creation-des-routes title="Permanent link">&para;</a></h2> <p>Les routes permettent de d√©finir le comportement que doit prendre le message selon son contenu. Dans notre exemple, nous allons d√©finir deux types de routes: une route permettant de filtrer les messages par contenu, en envoyant les messages contenant le nom ‚ÄúAlice‚Äù vers un ESB, et le reste vers l‚Äôautre ESB. Une deuxi√®me route permettra de modifier le contenu de certains messages avant de les faire parvenir √† leurs destinataires.</p> <h3 id=premiere-route-filtrage-des-messages>Premi√®re Route: Filtrage des Messages<a class=headerlink href=#premiere-route-filtrage-des-messages title="Permanent link">&para;</a></h3> <ul> <li>Cr√©er une nouvelle route en cliquant-droit sur <em>Routes -&gt; Cr√©er une Route</em>. Nous allons l‚Äôappeler FiltrageRoute.</li> <li>D√©finir votre route de mani√®re √† ce qu‚Äôelle ressemble √† ce qui suit:</li> </ul> <p><center><img src=../img/tp3/filtrage-route.png width=500 height=300></center></p> <ul> <li> <p>Les composants utilis√©s sont:</p> <ul> <li><strong>cSOAP</strong> : fournit l'int√©gration avec Apache CXF pour la connexion aux services JAX-WS.</li> <li><strong>MessageRouter</strong>¬†: route des messages dans diff√©rents canaux selon des conditions sp√©cifi√©es.</li> </ul> </li> <li> <p>Configurer la condition <em>when</em>, en pr√©cisant que c‚Äôest une condition de type <strong><em>simple</em></strong>, dont le texte est :</p> </li> </ul> <p><div class=highlight><pre><span></span><code>    <span class=s2>&quot;</span><span class=si>${</span><span class=nv>bodyAs</span><span class=p>(String)</span><span class=si>}</span><span class=s2> contains &#39;Alice&#39;&quot;</span>
</code></pre></div> Cela veut dire que, si le corps du message contient <em>Alice</em>, la requ√™te sera rout√©e vers le composant <em>cSOAP_2</em>.</p> <ul> <li> <p>Configurer le composant cSOAP_1:</p> <ul> <li>Adresse: <a href=http://localhost:8042/services/HelloWorldService>http://localhost:8042/services/HelloWorldService</a></li> <li>WSDL: <a href=http://localhost:8040/services/HelloWorldService?WSDL>http://localhost:8040/services/HelloWorldService?WSDL</a>.</li> </ul> </li> </ul> <div class="admonition tip"> <p class=admonition-title>Remarque</p> <p>Remarquez ici que le port utilis√© pour l'adresse est 8042: c'est le port choisi pour le service fa√ßade fourni par la route. Le WSDL utilis√©, par contre, est celui du service initial, expos√© sur le port 8040, donc sur le premier ESB.</p> </div> <ul> <li>Configurer l‚Äôadresse de cSOAP_2 sur le port 8040, et celle de cSOAP_3 sur le port 8041, tout en gardant le m√™me WSDL pour les trois composants.</li> <li>Lancer la route pour la tester. La console devra afficher <em>connected</em>.</li> </ul> <p>Pour utiliser cette route, vous devez reconfigurer votre consommateur pour qu‚Äôil lance sa requ√™te sur le port 8042. Ex√©cutez-le et observez le r√©sultat sur les terminaux des deux instances d‚ÄôESB d√©marr√©es. Que constatez-vous?</p> <details class=fail> <summary>Erreur possible: java.lang.NoClassDefFoundError</summary> <p>Dans le cas d'une erreur de type <em>java.lang.NoClassDefFoundError</em>, v√©rifier que tous les modules n√©cessaires sont bien t√©l√©charg√©s. Pour cela:</p> <ul> <li>Ouvrir _Window -&gt; Show View... -&gt; Modules</li> <li>V√©rifier qu'il n'y a pas de modules n√©cessaires non t√©l√©charg√©s (leur statut est <em>Not Installed</em> avec une ic√¥ne de type <img alt=‚ö†Ô∏è class=emojione src=https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/26a0.svg title=:warning:> ou <img alt=üö´ class=emojione src=https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg title=:no_entry_sign:>).</li> <li>Si vous en trouvez, t√©l√©chargez leur jar manuellement sur internet, et ajoutez-le au projet en cliquant sur le symbole du jar, comme indiqu√© dans la figure suivante: <center><img src=../img/tp3/import_jar.png width=500 height=300></center></li> </ul> </details> <h3 id=deploiement-des-routes-sur-lesb>D√©ploiement des Routes sur l'ESB<a class=headerlink href=#deploiement-des-routes-sur-lesb title="Permanent link">&para;</a></h3> <p>Dans leur √©tat actuel, vos routes doivent √™tre lanc√©es manuellement pour √™tre prises en consid√©ration. Pour les d√©ployer sur votre ESB et les garder ainsi toujours actives, suivre les √©tapes suivantes:</p> <ul> <li>Faites un clic-droit sur votre route et s√©lectionner: <em>Build Route</em> (veillez √† ce que le job FiltrageRoute soit bien arr√™t√©).</li> <li>Choisir le r√©pertoire deploy du conteneur de votre choix.</li> <li>Tester votre route en ex√©cutant √† nouveau le consommateur.</li> </ul> <div class="admonition warning"> <p class=admonition-title>Attention</p> <p>Vous ne devez en aucun cas d√©ployer votre route sur deux contenaires, sinon, il y'aura un conflit, car deux services fa√ßades seront expos√©s, ayant la m√™me adresse.</p> </div> <h3 id=deuxieme-route-filtrage-et-modification-de-messages>Deuxi√®me Route : Filtrage et Modification de Messages<a class=headerlink href=#deuxieme-route-filtrage-et-modification-de-messages title="Permanent link">&para;</a></h3> <p>Dans cette nouvelle partie, nous allons modifier le corps du message apr√®s l‚Äôavoir filtr√©. Pour cela:</p> <ul> <li>Dans Talend Studio, dupliquer votre route <em>FiltrageRoute</em> et la nommer <em>ModificationRoute</em>.</li> <li>Ins√©rer un composant <em>cSetBody</em> (permettant de modifier le corps du message re√ßu) puis un composant <em>cProcessor</em> (permettant de remanier rapidement du code dans la route) entre le <em>cMessageRouter</em> et le <em>cSOAP_3</em>. Le but ici est de modifier le corps des messages re√ßus, selon leur contenu. Le r√©sultat obtenu ressemblera au suivant:</li> </ul> <p><center><img src=../img/tp3/modification-route.png></center></p> <ul> <li>Ins√©rer le code suivant (de type Xpath) dans le <em>cSetBody</em> :</li> </ul> <div class=highlight><pre><span></span><code>  &quot;tns:HelloWorldServiceOperationRequest/in&quot;
</code></pre></div> <p>Ceci permet de saisir le contenu de la balise <em>in</em> de la requ√™te SOAP envoy√©e par le consommateur. Il ne faut pas oublier de d√©finir le Namespace <em>tns</em> (<a href=http://www.talend.org/service/ >http://www.talend.org/service/</a>).</p> <ul> <li>Ins√©rer le code suivant dans le processeur:</li> </ul> <div class=highlight><pre><span></span><code><span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=n>exchange</span><span class=p>.</span><span class=na>getIn</span><span class=p>().</span><span class=na>getBody</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
<span class=n>String</span> <span class=n>surname</span><span class=p>;</span>
<span class=k>if</span> <span class=p>(</span><span class=n>name</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=s>&quot;Bob&quot;</span><span class=p>)){</span>
  <span class=n>surname</span> <span class=o>=</span> <span class=s>&quot;Bobby&quot;</span><span class=p>;</span>
<span class=p>}</span><span class=k>else</span><span class=p>{</span>
  <span class=n>surname</span> <span class=o>=</span> <span class=s>&quot;Chucky&quot;</span><span class=p>;</span>
<span class=p>}</span>
<span class=n>exchange</span><span class=p>.</span><span class=na>getIn</span><span class=p>().</span><span class=na>setBody</span><span class=p>(</span><span class=s>&quot;&lt;tns:HelloWorldServiceOperationRequest &quot;</span><span class=o>+</span>
    <span class=s>&quot;xmlns:tns=\&quot;http://www.talend.org/service/\&quot;&gt;&lt;in&gt;&quot;</span>
    <span class=o>+</span><span class=n>surname</span><span class=o>+</span><span class=s>&quot;&lt;/in&gt; &lt;/tns:HelloWorldServiceOperationRequest&gt;&quot;</span><span class=p>);</span>
</code></pre></div> <p>Ce code permet de modifier le corps du message entrant en rempla√ßant le nom par un surnom.</p> <ul> <li>Modifier l'adresse du composant <em>cSOAP_1</em> pour qu'il se lance sur le port 8043.</li> <li>Sauvegarder et exporter votre route dans l‚ÄôESB. Lancer le consommateur de nouveau et observez le r√©sultat.</li> </ul> <h2 id=fonctionnalites-supplementaires-de-lesb>Fonctionnalit√©s Suppl√©mentaires de l'ESB<a class=headerlink href=#fonctionnalites-supplementaires-de-lesb title="Permanent link">&para;</a></h2> <h3 id=failover-et-repartition-de-charge>Failover et R√©partition de Charge<a class=headerlink href=#failover-et-repartition-de-charge title="Permanent link">&para;</a></h3> <h4 id=service-locator>Service Locator<a class=headerlink href=#service-locator title="Permanent link">&para;</a></h4> <p>Via le Service Locator, l'ESB de Talend fournit des fonctionnalit√©s de gestion de failover automatique et transparente ainsi que de r√©partition de charge via le lookup et l'enregistrement d'endpoints dynamiques dans Apache Zookeeper. Le Service Locator maintient la disponibilit√© du service afin de r√©pondre aux demandes et aux Service Level Agreements (SLAs).</p> <h4 id=configuration-du-service-locator>Configuration du Service Locator<a class=headerlink href=#configuration-du-service-locator title="Permanent link">&para;</a></h4> <p>Pour activer le service locator (SL), il faut:</p> <ol> <li>D√©ployer SL au niveau des conteneurs d‚Äôex√©cution Talend</li> <li>Activer la prise en compte du SL au niveau du service cible</li> <li>Configurer le consommateur du service pour prendre en compte le SL</li> </ol> <h5 id=1-deploiement-du-sl-dans-le-contenaire>1. D√©ploiement du SL dans le contenaire<a class=headerlink href=#1-deploiement-du-sl-dans-le-contenaire title="Permanent link">&para;</a></h5> <p>Pour tester sa capacit√© √† g√©rer le failover et la r√©partition des charges, le SL doit √™tre d√©ploy√© dans les diff√©rents conteneurs de services o√π sera d√©ploy√© votre service. Pour cela, taper dans l‚Äôinvite de commande de chaque conteneur ESB:</p> <div class=highlight><pre><span></span><code><span class=na>  tesb</span><span class=o>:</span><span class=s>start-locator</span><span class=w></span>
</code></pre></div> <p>Il est possible de visualiser votre SL dans la liste des services d√©ploy√©s sur le conteneur en tapant list sur votre terminal. Vous devriez trouver les lignes suivantes:</p> <p><center><img src=../img/tp3/activ-locator.png></center></p> <h5 id=2-activer-sl-dans-le-service>2. Activer SL dans le service<a class=headerlink href=#2-activer-sl-dans-le-service title="Permanent link">&para;</a></h5> <p>Pour activer la prise en compte de SL au niveau de notre service utilisateur dans Talend Studio:</p> <ul> <li>Clic-droit sur le service</li> <li>Choisir <em>ESB Runtime Options</em></li> <li>Cocher la case <em>"Utiliser le Service Locator"</em></li> </ul> <p>Il faut veiller √† re-d√©ployer votre service dans les deux conteneurs apr√®s l‚Äôactivation de la fonctionnalit√©.</p> <h5 id=3-activer-sl-dans-le-consommateur>3. Activer SL dans le consommateur<a class=headerlink href=#3-activer-sl-dans-le-consommateur title="Permanent link">&para;</a></h5> <p>Au niveau du consommateur du service, dans les propri√©t√©s du composant tESB, cocher la case <em>Use Service Locator</em>.</p> <h4 id=test-du-service-locator>Test du Service Locator<a class=headerlink href=#test-du-service-locator title="Permanent link">&para;</a></h4> <ul> <li> <p>Pour tester la r√©partition de charges* : Lancer le consommateur plusieurs fois sur le port 8040 et observez le r√©sultat.</p> </li> <li> <p>Pour tester la gestion du failover* : Arr√™ter le service sur le contenaire principal (8040). Pour cela, dans l'invite de commande du contenaire principal, taper <em>list</em>, puis chercher l'identifiant du service <em>HelloWorldService</em>. Taper ensuite : <em>stop &lt;id_service></em>. Lancer le consommateur sur le endpoint 8040, et observez le r√©sultat.</p> </li> </ul> <h3 id=service-monitoring>Service Monitoring<a class=headerlink href=#service-monitoring title="Permanent link">&para;</a></h3> <p>Le composant SAM permet le logging et la surveillance des appels de service, r√©alis√©s avec le framework Apache CXF. Il peut √™tre utilis√© pour collecter, par exemple, les statistiques d‚Äôusage et le monitoring des fautes.</p> <p>Pour configurer le Service Activity Monitoring:</p> <ol> <li> <p>D√©ployer SAM au niveau du conteneur d‚Äôex√©cution Talend. Pour cela, taper : <div class=highlight><pre><span></span><code><span class=na>tesb</span><span class=o>:</span><span class=s>start-sam</span><span class=w></span>
</code></pre></div> Vous remarquerez qu‚Äôune base de donn√©es Derby sera √©galement d√©ploy√©e sur le conteneur: elle permet de stocker les informations sur l‚Äôactivit√© des services.</p> </li> <li> <p>Activer la prise en compte de SAM au niveau du service cible</p> </li> <li>Configurer le consommateur du service pour prendre en compte le SAM</li> </ol> <p>Pour visualiser le r√©sultat de la surveillance, utiliser un visualiseur de bases de donn√©es, tel que <a href=https://dbeaver.io/download/ >DBeaver</a>.</p> <p>Pour acc√©der √† la base de donn√©es de monitoring, utiliser les param√®tres de configuration suivants:</p> <ul> <li><em>Database connection configuration</em>: Derby Server</li> <li><em>Driver</em>: Derby Server</li> <li><em>Database Server</em>: localhost</li> <li><em>Database Port</em>: 1527</li> <li><em>Database</em>: DB</li> <li><em>DB username</em>: test</li> <li><em>DB password</em>: test</li> </ul> <p>Ex√©cuter votre service plusieurs fois, et observer le r√©sultat.</p> <h3 id=authentification>Authentification<a class=headerlink href=#authentification title="Permanent link">&para;</a></h3> <h4 id=security-token-service-sts-implementation-du-ws-trust>Security Token Service (STS) : Impl√©mentation du WS-Trust<a class=headerlink href=#security-token-service-sts-implementation-du-ws-trust title="Permanent link">&para;</a></h4> <p>Dans un environnement h√©t√©rog√®ne, les services web doivent authentifier les services clients pour contr√¥ler leur acc√®s, gr√¢ce √† la norme WS-Security, et en impl√©mentant le WS-Trust. <em>"Trust"</em> veut dire <em>"Confiance"</em>: le but ici est donc d‚Äô√©tablir un lien de confiance entre le consommateur et le fournisseur.</p> <p>Pour cela, un courtier d‚Äôauthentification est utilis√©, fournissant un contr√¥le d‚Äôacc√®s pour les applications. Ce courtier d√©livre des jetons de s√©curit√© utilis√©s par les clients pour s‚Äôauthentifier au service.</p> <p>Le STS (<em>Security Token Service</em>) est un service web qui fournit un tel courtier d‚Äôauthentification. Ses jetons respectent le standard WS-Trust. Il offre les fonctionnalit√©s suivantes:</p> <ul> <li>D√©livrer un jeton de s√©curit√© bas√© sur des param√®tres d‚Äôauthentification configur√©s.</li> <li>V√©rifier la validit√© d‚Äôun param√®tre d‚Äôauthentification</li> <li>Renouveler un jeton de s√©curit√©</li> <li>Annuler un jeton de s√©curit√©</li> <li>Transformer un jeton de s√©curit√© donn√© en un autre de type diff√©rent.</li> </ul> <p>L‚Äôutilisation d‚Äôun STS simplifie grandement la gestion de la s√©curit√© pour le service et le client, car ils n‚Äôont qu‚Äô√† faire appel √† ce STS, qui va g√©rer la logique de s√©curit√©, au lieu de la traiter eux-m√™mes.</p> <h4 id=configuration-des-parametres-de-securite>Configuration des Param√®tres de S√©curit√©<a class=headerlink href=#configuration-des-parametres-de-securite title="Permanent link">&para;</a></h4> <p>Pour associer des param√®tres de confidentialit√© √† un service, il faut suivre les √©tapes suivantes:</p> <ol> <li>D√©ployer STS dans le conteneur d‚Äôex√©cution Talend</li> <li>Configurer les param√®tres de s√©curit√© de votre conteneur</li> <li>Activer la prise en compte de STS dans votre service</li> <li>Configurer votre client pour saisir les param√®tres d‚Äôauthentification.</li> </ol> <h5 id=1-deployer-sts-dans-le-conteneur-dexecution>1. D√©ployer STS dans le conteneur d‚Äôex√©cution<a class=headerlink href=#1-deployer-sts-dans-le-conteneur-dexecution title="Permanent link">&para;</a></h5> <p>Pour installer le service STS dans votre conteneur, d√©marrer ce dernier, et taper l‚Äôinstruction suivante dans le terminal: <div class=highlight><pre><span></span><code><span class=na>    feature</span><span class=o>:</span><span class=s>install tesb-sts</span><span class=w></span>
</code></pre></div></p> <p>Si le service a bien √©t√© install√©, vous pouvez v√©rifier qu‚Äôil est bien d√©marr√© en ex√©cutant la commande : <em>list</em>. Vous devriez trouver les lignes suivantes:</p> <p><center><img src=../img/tp3/activ-sts.png></center></p> <h5 id=2-configurer-les-parametres-de-securite-de-votre-conteneur>2. Configurer les param√®tres de s√©curit√© de votre conteneur<a class=headerlink href=#2-configurer-les-parametres-de-securite-de-votre-conteneur title="Permanent link">&para;</a></h5> <p>Comme c‚Äôest le STS qui prend en charge le contr√¥le d‚Äôacc√®s, les param√®tres d‚Äôauthentification (le login/mdp par exemple) ne sont pas configur√©s au niveau du service fournisseur, mais au niveau du conteneur lui-m√™me.</p> <p>Pour visualiser l‚Äôensemble des utilisateurs autoris√©s sur votre conteneur, voir leurs mots de passes et r√¥les, et √©ventuellement en ajouter de nouveaux, ouvrir le fichier: <em>&lt;conteneur>/etc/users.properties</em>.</p> <p>Dans ce fichier, les informations d'authentification sont sous la forme: <em>user=password,group</em>. Ajouter une nouvelle ligne avec votre nom comme user et un mot de passe de votre choix, et choisir le groupe <em>admin</em>.</p> <h5 id=3-activer-sts-dans-votre-service>3. Activer STS dans votre service<a class=headerlink href=#3-activer-sts-dans-votre-service title="Permanent link">&para;</a></h5> <p>Pour activer la prise en compte de STS au niveau de notre service utilisateur dans Talend Studio, dans <em>ESB Runtime Options</em>, cocher le type d‚Äôauthentification d√©sir√© (dans notre cas, <em>Identifiant/Mot de passe</em>)</p> <h5 id=4-configurer-le-client>4. Configurer le client<a class=headerlink href=#4-configurer-le-client title="Permanent link">&para;</a></h5> <p>Pour ins√©rer le login/mdp dans votre application cliente, modifier les param√®tres d‚Äôauthentification de votre composant tESBConsumer dans votre job consommateur.</p> <h2 id=homework>Homework<a class=headerlink href=#homework title="Permanent link">&para;</a></h2> <div class="admonition note"> <p class=admonition-title>Projet E2</p> <p>Pour la s√©ance de TP prochaine, vous devez r√©aliser l'√©tape 2 du projet, qui consiste √†:</p> <ul> <li>Terminer les diagrammes de votre entreprise commenc√©s la semaine d'avant.</li> <li>Concevoir et commencer l'impl√©mentation des services n√©cessaires pour votre PoC. </li> <li>R√©fl√©chir √† l'usage des ESB, leur r√¥le et les strat√©gies qui y seront impl√©ment√©es.</li> </ul> </div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2023-09-25T22:24:50+01:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-09-25</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 Lilia Sfaxi </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.092fa1f6.min.js"}</script> <script src=../assets/javascripts/bundle.e3b2bf44.min.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> </body> </html>