<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Les Travaux Pratiques du cours Urbanisation des Systèmes d'Information"><meta name=author content="Lilia Sfaxi"><link href=http://INSATunisia.github.io/TP-Urbanisation/tp2/ rel=canonical><link rel=icon href=../img/favicon.ico><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.1.10"><title>TP2 - REST API Management avec Anypoint Studio - TP Urbanisation des Systèmes d'Information</title><link rel=stylesheet href=../assets/stylesheets/main.d6be258b.min.css><link rel=stylesheet href=../assets/stylesheets/palette.e6a45f82.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Questrial:300,400,400i,700%7CSource+Code+Pro&display=fallback"><style>:root{--md-text-font:"Questrial";--md-code-font:"Source Code Pro"}</style><link rel=stylesheet href=../css/timeago.css><link rel=stylesheet href=../stylesheets/extra.css><link rel=stylesheet href=../stylesheets/links.css><link rel=stylesheet href=../stylesheets/custom.css><script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=amber data-md-color-accent=amber> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#telecharger-pdf class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="TP Urbanisation des Systèmes d'Information" class="md-header__button md-logo" aria-label="TP Urbanisation des Systèmes d'Information" data-md-component=logo> <img src=../img/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> TP Urbanisation des Systèmes d'Information </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> TP2 - REST API Management avec Anypoint Studio </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=amber data-md-color-accent=amber aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=amber data-md-color-accent=amber aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/INSATunisia/TP-Urbanisation/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> INSATunisia/TP-Urbanisation </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="TP Urbanisation des Systèmes d'Information" class="md-nav__button md-logo" aria-label="TP Urbanisation des Systèmes d'Information" data-md-component=logo> <img src=../img/logo.png alt=logo> </a> TP Urbanisation des Systèmes d'Information </label> <div class=md-nav__source> <a href=https://github.com/INSATunisia/TP-Urbanisation/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> INSATunisia/TP-Urbanisation </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Travaux Pratiques Urbanisation des SI </a> </li> <li class=md-nav__item> <a href=../projet/ class=md-nav__link> Projet </a> </li> <li class=md-nav__item> <a href=../tp1/ class=md-nav__link> TP1 - Services Web SOAP avec Mule ESB </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> TP2 - REST API Management avec Anypoint Studio <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> TP2 - REST API Management avec Anypoint Studio </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#telecharger-pdf class=md-nav__link> Télécharger PDF </a> </li> <li class=md-nav__item> <a href=#objectifs-du-tp class=md-nav__link> Objectifs du TP </a> </li> <li class=md-nav__item> <a href=#outils-et-versions class=md-nav__link> Outils et Versions </a> </li> <li class=md-nav__item> <a href=#api-management-avec-anypoint-studio class=md-nav__link> API Management avec Anypoint Studio </a> </li> <li class=md-nav__item> <a href=#generation-dapi-avec-raml class=md-nav__link> Génération d'API avec RAML </a> <nav class=md-nav aria-label="Génération d'API avec RAML"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#raml class=md-nav__link> RAML </a> </li> <li class=md-nav__item> <a href=#creation-de-lapi-raml-avec-anypoint-api-designer class=md-nav__link> Création de l'API RAML avec AnyPoint API Designer </a> </li> <li class=md-nav__item> <a href=#creation-dun-document-raml class=md-nav__link> Création d’un document RAML </a> <nav class=md-nav aria-label="Création d’un document RAML"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creation-dune-api-raml class=md-nav__link> Création d’une API RAML </a> </li> <li class=md-nav__item> <a href=#definir-des-types class=md-nav__link> Définir des types </a> </li> <li class=md-nav__item> <a href=#extraction-dun-type-de-ressources class=md-nav__link> Extraction d’un type de ressources </a> </li> <li class=md-nav__item> <a href=#ajout-de-parametres-au-type-de-ressource class=md-nav__link> Ajout de paramètres au type de ressource </a> </li> <li class=md-nav__item> <a href=#ajout-dun-exemple class=md-nav__link> Ajout d’un exemple </a> </li> <li class=md-nav__item> <a href=#creation-du-service-rest-avec-apikit class=md-nav__link> Création du service REST avec APIKit </a> <nav class=md-nav aria-label="Création du service REST avec APIKit"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creation-du-projet-rest-dans-mule class=md-nav__link> Création du projet REST dans Mule </a> </li> <li class=md-nav__item> <a href=#configuration-du-flux-principal class=md-nav__link> Configuration du flux principal </a> </li> <li class=md-nav__item> <a href=#implementation-du-service-statiquement-dans-mule class=md-nav__link> Implémentation du service statiquement dans Mule </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#appel-au-service-soap-du-tp1-a-partir-de-lapi-rest class=md-nav__link> Appel au service SOAP du TP1 à partir de l'API REST </a> <nav class=md-nav aria-label="Appel au service SOAP du TP1 à partir de l'API REST"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#modifier-le-raml-initial class=md-nav__link> Modifier le RAML initial </a> </li> <li class=md-nav__item> <a href=#appeler-le-service-soap class=md-nav__link> Appeler le service SOAP </a> </li> <li class=md-nav__item> <a href=#lancer-les-services class=md-nav__link> Lancer les services </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#homework class=md-nav__link> Homework </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../tp3/ class=md-nav__link> TP3 - Orchestration de Services avec Camunda </a> </li> <li class=md-nav__item> <a href=../tp4/ class=md-nav__link> TP4 - Intégration BPM et ESB </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#telecharger-pdf class=md-nav__link> Télécharger PDF </a> </li> <li class=md-nav__item> <a href=#objectifs-du-tp class=md-nav__link> Objectifs du TP </a> </li> <li class=md-nav__item> <a href=#outils-et-versions class=md-nav__link> Outils et Versions </a> </li> <li class=md-nav__item> <a href=#api-management-avec-anypoint-studio class=md-nav__link> API Management avec Anypoint Studio </a> </li> <li class=md-nav__item> <a href=#generation-dapi-avec-raml class=md-nav__link> Génération d'API avec RAML </a> <nav class=md-nav aria-label="Génération d'API avec RAML"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#raml class=md-nav__link> RAML </a> </li> <li class=md-nav__item> <a href=#creation-de-lapi-raml-avec-anypoint-api-designer class=md-nav__link> Création de l'API RAML avec AnyPoint API Designer </a> </li> <li class=md-nav__item> <a href=#creation-dun-document-raml class=md-nav__link> Création d’un document RAML </a> <nav class=md-nav aria-label="Création d’un document RAML"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creation-dune-api-raml class=md-nav__link> Création d’une API RAML </a> </li> <li class=md-nav__item> <a href=#definir-des-types class=md-nav__link> Définir des types </a> </li> <li class=md-nav__item> <a href=#extraction-dun-type-de-ressources class=md-nav__link> Extraction d’un type de ressources </a> </li> <li class=md-nav__item> <a href=#ajout-de-parametres-au-type-de-ressource class=md-nav__link> Ajout de paramètres au type de ressource </a> </li> <li class=md-nav__item> <a href=#ajout-dun-exemple class=md-nav__link> Ajout d’un exemple </a> </li> <li class=md-nav__item> <a href=#creation-du-service-rest-avec-apikit class=md-nav__link> Création du service REST avec APIKit </a> <nav class=md-nav aria-label="Création du service REST avec APIKit"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creation-du-projet-rest-dans-mule class=md-nav__link> Création du projet REST dans Mule </a> </li> <li class=md-nav__item> <a href=#configuration-du-flux-principal class=md-nav__link> Configuration du flux principal </a> </li> <li class=md-nav__item> <a href=#implementation-du-service-statiquement-dans-mule class=md-nav__link> Implémentation du service statiquement dans Mule </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#appel-au-service-soap-du-tp1-a-partir-de-lapi-rest class=md-nav__link> Appel au service SOAP du TP1 à partir de l'API REST </a> <nav class=md-nav aria-label="Appel au service SOAP du TP1 à partir de l'API REST"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#modifier-le-raml-initial class=md-nav__link> Modifier le RAML initial </a> </li> <li class=md-nav__item> <a href=#appeler-le-service-soap class=md-nav__link> Appeler le service SOAP </a> </li> <li class=md-nav__item> <a href=#lancer-les-services class=md-nav__link> Lancer les services </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#homework class=md-nav__link> Homework </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/INSATunisia/TP-Urbanisation/edit/master/docs/tp2.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>TP2 - REST API Management avec Anypoint Studio</h1> <p><center> <img alt=API src=../img/api.png> </center></p> <h2 id=telecharger-pdf>Télécharger PDF<a class=headerlink href=#telecharger-pdf title="Permanent link">&para;</a></h2> <p><a href=../tp2.pdf><img alt="Download TP4" src=../img/pdf.png></a></p> <h2 id=objectifs-du-tp>Objectifs du TP<a class=headerlink href=#objectifs-du-tp title="Permanent link">&para;</a></h2> <ol> <li>Génération d’API avec Anypoint API Designer et le langage RAML</li> <li>Gestion des APIs avec Anypoint Studio et le API Gateway de Mulesoft</li> </ol> <h2 id=outils-et-versions>Outils et Versions<a class=headerlink href=#outils-et-versions title="Permanent link">&para;</a></h2> <ul> <li><a href=https://www.mulesoft.com/lp/dl/anypoint-mule-studio>Anypoint Studio 7 and Mule ESB 4</a></li> <li><a href=https://dev.mysql.com/downloads/ >MySQL</a> Version <em>latest</em></li> <li>Dans ce TP, nous aurons besoin du service SOAP créé dans le <a href=../tp1/#service-web-rest--interrogation-dune-base-de-données>TP1</a>.</li> </ul> <h2 id=api-management-avec-anypoint-studio>API Management avec Anypoint Studio<a class=headerlink href=#api-management-avec-anypoint-studio title="Permanent link">&para;</a></h2> <h2 id=generation-dapi-avec-raml>Génération d'API avec RAML<a class=headerlink href=#generation-dapi-avec-raml title="Permanent link">&para;</a></h2> <h3 id=raml>RAML<a class=headerlink href=#raml title="Permanent link">&para;</a></h3> <p><a href=https://raml.org/ >RAML</a> (RESTful API Modeling Language) est un langage pour la définition d’API HTTP qui satisfont les exigences de l'architecture REST. La spécification RAML est une application de la spécification YAML, qui fournit des mécanismes pour la définition d’APIs RESTful.</p> <p>RAML est développé et supporté par un groupe de leaders en nouvelles technologies, provenant de plusieurs entreprises éminentes (Mulesoft, Airware, Akana, VMware, CISCO…). Leur but est de construire une spécification ouverte, simple et succincte pour la description d’APIs. Ce groupe de travail contribue à la fois à la spécification RAML, ainsi qu’à un écosystème croissant d’outils autours de ce langage.</p> <h3 id=creation-de-lapi-raml-avec-anypoint-api-designer>Création de l'API RAML avec AnyPoint API Designer<a class=headerlink href=#creation-de-lapi-raml-avec-anypoint-api-designer title="Permanent link">&para;</a></h3> <p>Pour écrire un document RAML, ouvrir Anypoint Studio, et créer un nouveau projet de type <strong>"API Specification Project"</strong>, intitulé <em>CountriesAPI</em> de type <em>RAML 1.0</em>. L'interface suivante devra s'afficher:</p> <p><img alt="New RAML Project" src=../img/tp2/raml.png></p> <h3 id=creation-dun-document-raml>Création d’un document RAML<a class=headerlink href=#creation-dun-document-raml title="Permanent link">&para;</a></h3> <p>Dans ce qui suit, nous vous indiquons les étapes nécessaires pour créer un simple fichier RAML décrivant une API REST répondant aux recommandations de bonne conception d'API REST.</p> <h4 id=creation-dune-api-raml>Création d’une API RAML<a class=headerlink href=#creation-dune-api-raml title="Permanent link">&para;</a></h4> <p>Remplir le fichier <em>countriesapi.raml</em> créé pour qu'il ressemble à ce qui suit:</p> <div class=highlight><pre><span></span><code><span class=c1>#%RAML 1.0</span><span class=w></span>
<span class=nt>title</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Countries</span><span class=w></span>
<span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<span class=nt>baseUri</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/countries</span><span class=w></span>

<span class=nt>/countries</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>get</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>responses</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>200</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>body</span><span class=p>:</span><span class=w></span>
<span class=w>          </span><span class=nt>application/json</span><span class=p>:</span><span class=w></span>
<span class=w>            </span><span class=nt>properties</span><span class=p>:</span><span class=w></span>
<span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class=w></span>
<span class=w>              </span><span class=nt>population</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">number</span><span class=w></span>
<span class=w>              </span><span class=nt>capital</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class=w></span>
<span class=w>              </span><span class=nt>currency</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class=w></span>
<span class=w>  </span><span class=nt>post</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>body</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>application/json</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>properties</span><span class=p>:</span><span class=w></span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class=w></span>
<span class=w>            </span><span class=nt>population</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">number</span><span class=w></span>
<span class=w>            </span><span class=nt>capital</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class=w></span>
<span class=w>            </span><span class=nt>currency</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class=w></span>
<span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">/{id}</span><span class="p p-Indicator">:</span><span class=w></span>
<span class=w>    </span><span class=nt>delete</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>responses</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>204</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>put</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>body</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>application/json</span><span class=p>:</span><span class=w></span>
<span class=w>          </span><span class=nt>properties</span><span class=p>:</span><span class=w></span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class=w></span>
<span class=w>            </span><span class=nt>population</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">number</span><span class=w></span>
<span class=w>            </span><span class=nt>capital</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class=w></span>
<span class=w>            </span><span class=nt>currency</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class=w></span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>Attention!</p> <p>Prenez soin de respecter les tabulations et les retraits de ligne!</p> </div> <p>Dans cette description, nous définissons le comportement principal de l'API, à l'appel des quatre méthodes les plus fréquentes: un <em>GET</em> ou un <em>POST</em> sur la ressource principale, et un <em>DELETE</em> ou un <em>PUT</em> sur un objet particulier représenté par son <em>id</em>.</p> <h4 id=definir-des-types>Définir des types<a class=headerlink href=#definir-des-types title="Permanent link">&para;</a></h4> <p>Pour éviter les redondances constatées dans notre définition, nous créons le type <em>Country</em>. Pour cela:</p> <ul> <li>Dans une nouvelle ligne au dessus de <em>/countries</em>, taper les lignes suivantes:</li> </ul> <div class=highlight><pre><span></span><code><span class=nt>types</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>Country</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>properties</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class=w></span>
<span class=w>      </span><span class=nt>population</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">number</span><span class=w></span>
<span class=w>      </span><span class=nt>capital</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class=w></span>
<span class=w>      </span><span class=nt>currency</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class=w></span>
</code></pre></div> <ul> <li>Définir <em>Country</em> comme type pour le corps de la méthode <em>post</em>, en écrivant: <strong>type: Country</strong> au dessous de <em>application/json</em> de la méthode post</li> <li>Ajouter de même <em>Country</em> comme type pour la méthode put, et <em>Country[]</em> pour la méthode get.</li> </ul> <h4 id=extraction-dun-type-de-ressources>Extraction d’un type de ressources<a class=headerlink href=#extraction-dun-type-de-ressources title="Permanent link">&para;</a></h4> <p>Pour générer un type de ressources à partir d’une ressource existante:</p> <ul> <li>Ajouter le code suivant au dessus du <em>title</em>:</li> </ul> <div class=highlight><pre><span></span><code><span class=nt>resourceTypes</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>Collection</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>get</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>responses</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>200</span><span class=p>:</span><span class=w></span>
<span class=w>          </span><span class=nt>body</span><span class=p>:</span><span class=w></span>
<span class=w>            </span><span class=nt>application/json</span><span class=p>:</span><span class=w></span>
<span class=w>              </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Country[]</span><span class=w></span>
<span class=w>    </span><span class=nt>post</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>body</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>application/json</span><span class=p>:</span><span class=w></span>
<span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Country</span><span class=w></span>
<span class=w>  </span><span class=nt>Member</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>delete</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>responses</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>204</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>put</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>body</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>application/json</span><span class=p>:</span><span class=w></span>
<span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Country</span><span class=w></span>
</code></pre></div> <ul> <li>Supprimer le contenu de /countries et de /{id} pour le remplacer par les nouveaux resourceTypes définis en utilisant: <strong>type: Collection</strong> et <strong>type: Member</strong>.</li> </ul> <h4 id=ajout-de-parametres-au-type-de-ressource>Ajout de paramètres au type de ressource<a class=headerlink href=#ajout-de-parametres-au-type-de-ressource title="Permanent link">&para;</a></h4> <p>Pour rendre le type de ressource créé générique, il serait plus intéressant de paramétrer le type de réponse. Pour cela:</p> <ul> <li>Remplacer le terme <em>Country</em> dans <em>Collection</em> et <em>Member</em> par <code>&lt;&lt;item&gt;&gt;</code>.</li> <li>Remplacer les ressources <em>Collection</em> et <em>Member</em> respectivement par <code>{ Collection: {item : Country} }</code> et <code>{ Member: {item : Country} }</code></li> </ul> <h4 id=ajout-dun-exemple>Ajout d’un exemple<a class=headerlink href=#ajout-dun-exemple title="Permanent link">&para;</a></h4> <p>Pour ajouter un exemple de pays, modifier le type <em>Country</em> pour qu’il soit comme suit:</p> <div class=highlight><pre><span></span><code><span class=na>types</span><span class=o>:</span><span class=w></span>
<span class=na>  Country</span><span class=o>:</span><span class=w></span>
<span class=na>    properties</span><span class=o>:</span><span class=w></span>
<span class=na>      name</span><span class=o>:</span><span class=w> </span><span class=s>string</span><span class=w></span>
<span class=na>      population</span><span class=o>:</span><span class=w> </span><span class=s>number</span><span class=w></span>
<span class=na>      capital</span><span class=o>:</span><span class=w> </span><span class=s>string</span><span class=w></span>
<span class=na>      currency</span><span class=o>:</span><span class=w> </span><span class=s>string</span><span class=w></span>
<span class=na>    example</span><span class=o>:</span><span class=w></span>
<span class=na>      name</span><span class=o>:</span><span class=w> </span><span class=s>Spain</span><span class=w></span>
<span class=na>      population</span><span class=o>:</span><span class=w> </span><span class=s>46704314</span><span class=w></span>
<span class=na>      capital</span><span class=o>:</span><span class=w> </span><span class=s>Madrid</span><span class=w></span>
<span class=na>      currency</span><span class=o>:</span><span class=w> </span><span class=s>EUR</span><span class=w></span>
</code></pre></div> <h4 id=creation-du-service-rest-avec-apikit>Création du service REST avec APIKit<a class=headerlink href=#creation-du-service-rest-avec-apikit title="Permanent link">&para;</a></h4> <p>APIKit est un toolkit open source spécialement créé pour faciliter l’implémentation d’APIs REST, en renforçant les bonnes pratiques de création d’APIs.</p> <p>Nous allons commencer par implémenter l'API REST que nous venons de créer avec RAML de faon statique, puis en faisant appel au service SOAP créé dans le TP précédent. </p> <h5 id=creation-du-projet-rest-dans-mule><em>Création du projet REST dans Mule</em><a class=headerlink href=#creation-du-projet-rest-dans-mule title="Permanent link">&para;</a></h5> <p>Créer un nouveau Mule Project qu’on appellera <em>CountriesRESTService</em>:</p> <ul> <li>Choisir comme environnement d’exécution Mule Server.</li> <li>Cliquer sur l'onglet <strong>Import RAML from local file</strong> et choisir le fichier <em>countriesapi.raml</em> créé dans la première partie du TP.</li> </ul> <p>Un nouveau projet sera créé avec le fichiers <em>countriesapi.raml</em> sous le répertoire <em>src/main/resources/api</em>, ainsi que des flux de gestion des différentes méthodes ajoutées par défaut dans le canevas. Vous retrouverez notamment:</p> <table> <thead> <tr> <th>Flux</th> <th>Description</th> <th>Figure</th> </tr> </thead> <tbody> <tr> <td>countriesapi-main</td> <td>Flux principal, définissant un point d’accès HTTP, un routeur APIKit et une référence à une stratégie d'exception</td> <td><img alt=api-main src=../img/tp2/api-main.png></td> </tr> <tr> <td>action:/ressource:api-config</td> <td>Un Backend flow pour chaque paire de ressource/action dans le fichier RAML. Par exemple, <em>get:/products:api-config</em> représente l’action <em>get</em> de la ressource <em>products</em></td> <td><img alt=get-users src=../img/tp2/getcountries.png></td> </tr> </tbody> </table> <h5 id=configuration-du-flux-principal><em>Configuration du flux principal</em><a class=headerlink href=#configuration-du-flux-principal title="Permanent link">&para;</a></h5> <ul> <li>Dans les propriétés du composant Listener du flux principal (<em>countriesapi-main</em>), on peut constater que le chemin principal de l'api, représenté par le Path, est : <em>/api/*</em>.</li> <li>Dans le <em>Connector Configuration</em>, cliquer sur l'icône <img alt=config src=img/tp4/config.png>, modifier le port en 8088 pour éviter les conflits futurs avec le service SOAP du TP précédent, puis cliquer sur <em>OK</em>.</li> </ul> <p>Lancer le projet comme <em>Mule Application</em>. </p> <p>Pour commencer, afficher la documentation de l'API dans une <em>APIKit Console</em>. Pour cela:</p> <ul> <li>Aller à <em>Window -&gt; Show View -&gt; Other...</em></li> <li>Choisir <em>APIKit View -&gt; APIKit Consoles</em></li> </ul> <p>Une vue va s'afficher comme suit (regardez à gauche de l'écran):</p> <p><center><img src=../img/tp2/window-console.png width=40%></center></p> <p>Cliquer sur <em>Open Console</em>. Une fenêtre va s'afficher sur votre navigateur, comme suit:</p> <p><center><img src=../img/tp2/console.png width=40%></center></p> <p>Pour consulter votre API, cliquer par exemple sur le bouton <em>GET</em> de la ressource <em>/countries</em>. La console affichera alors la réponse, qui a été définie comme exemple dans le fichier RAML de départ.</p> <p><center><img src=../img/tp2/get-console.png width=60%></center></p> <h5 id=implementation-du-service-statiquement-dans-mule><em>Implémentation du service statiquement dans Mule</em><a class=headerlink href=#implementation-du-service-statiquement-dans-mule title="Permanent link">&para;</a></h5> <p>Nous allons implémenter la méthode <em>get</em> du service pour qu'elle extrait les données à partir de la base de données MySQL <em>Countries</em> créée dans le TP précédent. Pour cela, reconstruire le flux <em>get:\countries</em> de façon à obtenir le résultat suivant:</p> <p><center><img src=../img/tp2/get-db.png width=60%></center></p> <p>Pour tester que votre requête fonctionne bien, il suffit de taper le chemin suivant sur votre navigateur (ou tout autre outil de test REST: <code>http://localhost:8088/api/countries</code>. Si tout se passe bien, le résultat devrait ressembler à ce qui suit:</p> <div class=highlight><pre><span></span><code><span class=p>[</span><span class=w></span>
<span class=w>  </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=err>capi</span><span class=kc>tal</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Yerevan&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=kc>na</span><span class=err>me</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Armenia&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=err>curre</span><span class=kc>n</span><span class=err>cy</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;AMD&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=err>popula</span><span class=kc>t</span><span class=err>io</span><span class=kc>n</span><span class=p>:</span><span class=w> </span><span class=mi>3000000</span><span class=w></span>
<span class=w>  </span><span class=p>},</span><span class=w></span>
<span class=w>  </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=err>capi</span><span class=kc>tal</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Berlin&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=kc>na</span><span class=err>me</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Germany&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=err>curre</span><span class=kc>n</span><span class=err>cy</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;EUR&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=err>popula</span><span class=kc>t</span><span class=err>io</span><span class=kc>n</span><span class=p>:</span><span class=w> </span><span class=mi>83000000</span><span class=w></span>
<span class=w>  </span><span class=p>},</span><span class=w></span>
<span class=w>  </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=err>capi</span><span class=kc>tal</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Warsaw&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=kc>na</span><span class=err>me</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Poland&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=err>curre</span><span class=kc>n</span><span class=err>cy</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;PLN&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=err>popula</span><span class=kc>t</span><span class=err>io</span><span class=kc>n</span><span class=p>:</span><span class=w> </span><span class=mi>38000000</span><span class=w></span>
<span class=w>  </span><span class=p>},</span><span class=w></span>
<span class=w>  </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=err>capi</span><span class=kc>tal</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Moscow&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=kc>na</span><span class=err>me</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Russia&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=err>curre</span><span class=kc>n</span><span class=err>cy</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;RUB&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=err>popula</span><span class=kc>t</span><span class=err>io</span><span class=kc>n</span><span class=p>:</span><span class=w> </span><span class=mi>145000000</span><span class=w></span>
<span class=w>  </span><span class=p>},</span><span class=w></span>
<span class=w>  </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=err>capi</span><span class=kc>tal</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Madrid&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=kc>na</span><span class=err>me</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Spain&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=err>curre</span><span class=kc>n</span><span class=err>cy</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;EUR&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=err>popula</span><span class=kc>t</span><span class=err>io</span><span class=kc>n</span><span class=p>:</span><span class=w> </span><span class=mi>47420000</span><span class=w></span>
<span class=w>  </span><span class=p>},</span><span class=w></span>
<span class=w>  </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=err>capi</span><span class=kc>tal</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Tunis&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=kc>na</span><span class=err>me</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Tunisia&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=err>curre</span><span class=kc>n</span><span class=err>cy</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;TND&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=err>popula</span><span class=kc>t</span><span class=err>io</span><span class=kc>n</span><span class=p>:</span><span class=w> </span><span class=mi>12260000</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=p>]</span><span class=w></span>
</code></pre></div> <h4 id=appel-au-service-soap-du-tp1-a-partir-de-lapi-rest>Appel au service SOAP du TP1 à partir de l'API REST<a class=headerlink href=#appel-au-service-soap-du-tp1-a-partir-de-lapi-rest title="Permanent link">&para;</a></h4> <p>L'une des grandes utilités d'un ESB est d'intégrer les services existants qui utilisent parfois des protocoles ou technologies différentes. Nous allons montrer comment on pourra, avec notre service REST, faire appel à un service SOAP. </p> <p>On rappelle que le service SOAP créé précédemment, prend en entrée le nom d'un pays (paramètre <em>name</em> de type chaîne de caractères), et retourne une SOAP Response avec les informations relatives à ce pays, extraites de la base de données <em>countries</em>.</p> <h5 id=modifier-le-raml-initial><em>Modifier le RAML initial</em><a class=headerlink href=#modifier-le-raml-initial title="Permanent link">&para;</a></h5> <p>Nous devons modifier le fichier RAML initial de façon à exposer une méthode <strong>get</strong> qui prend en entrée un nom de pays. Pour cela:</p> <ol> <li>Ouvrir le fichier RAML dans le projet <em>countriesrestservice</em> (vous le trouverez sous <em>src/main/resources/api</em>), et ajouter, sous <em>Member</em>, l'élément suivant: <div class=highlight><pre><span></span><code><span class=w> </span><span class=nt>get</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>responses</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>200</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>body</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>application/json</span><span class=p>:</span><span class=w></span>
<span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt;item&gt;&gt;</span><span class=w></span>
</code></pre></div></li> <li> <p>Pour recharger le nouveau fichier et générer le flux que nous venons de créer, faire un clic-droit sur le projet, et choisir <strong>Mule -&gt; Generate Flows from Local REST API</strong>. Vous remarquerez que le flux suivant vient d'être ajouté: <center><img src=../img/tp2/get-id.png width=60%></center></p> </li> <li> <p>Nous commencerons par tester ce service. Pour cela, dans le second <em>Transform Message</em>, glisser-déplacer la variable <strong>id</strong> vers la sortie <strong>name</strong>, comme suit: <center><img src=../img/tp2/getid-transform.png width=60%></center></p> </li> <li> <p>Relancer ce service, et observer le résultat en tapant le chemin <code>http://localhost:8088/api/countries/Dorne</code>. L'affichage est bien sûr incongru, mais ça fonctionne s'il vous donne ça:</p> </li> </ol> <div class=highlight><pre><span></span><code><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=kc>na</span><span class=err>me</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;SpainDorne&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=err>popula</span><span class=kc>t</span><span class=err>io</span><span class=kc>n</span><span class=p>:</span><span class=w> </span><span class=mi>46704314</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=err>capi</span><span class=kc>tal</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Madrid&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=err>curre</span><span class=kc>n</span><span class=err>cy</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;EUR&quot;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <h5 id=appeler-le-service-soap><em>Appeler le service SOAP</em><a class=headerlink href=#appeler-le-service-soap title="Permanent link">&para;</a></h5> <p>Pour appeler votre service SOAP, modifier le flux de la requête <em>get:\countries(id)</em> comme suit:</p> <ol> <li>Supprimer tous les composants déjà existants.</li> <li>Ajouter le composant <strong>Web Service Consumer</strong>.</li> <li> <p>Le configurer comme suit:</p> <ul> <li>Devant <em>Connector configuration</em>, cliquer sur <img alt=add src=img/tp4/add.png> pour ajouter une nouvelle configuration.</li> <li>Coller le chemin du WSDL de votre service SOAP dans <em>WSDL Location</em> (si vous n'avez rien changé, cela devrait être <code>http://localhost:8081/CountriesPortService/CountriesPortSoap11?wsdl</code>) </li> <li>Cliquer sur OK pour valider. Les valeurs suivantes devraient s'afficher :<ul> <li><strong>Service</strong>: CountriesPortService</li> <li><strong>Port</strong>: CountriesPortSoap11</li> <li><strong>Address</strong>: <a href=http://localhost:8081/CountriesPortService/CountriesPortSoap11>http://localhost:8081/CountriesPortService/CountriesPortSoap11</a></li> </ul> </li> <li>Une fois cette fenêtre fermée, sélectionner (si ce n'est déjà fait) <em>getCountry</em> dans Operation. </li> <li>Dans la partie Body, cliquer sur le bouton pour mapper l'entrée du service REST à celui du service SOAP. Glisser-déplacer ensuite la variable <em>id</em> se trouvant sous <em>Attributes -&gt; uriParams</em> de la fenêtre de gauche, vers la variable <em>name</em> se trouvant sous <em>getCountryRequest</em> de la fenêtre de droite. Le code suivant devrait se générer : <div class=highlight><pre><span></span><code><span class=err>output</span><span class=w> </span><span class=err>application/xml</span><span class=w></span>
<span class=na>ns ns0 http</span><span class=o>:</span><span class=s>//spring.io/guides/gs-producing-web-service</span><span class=w></span>
<span class=err>---</span><span class=w></span>
<span class=err>{</span><span class=w></span>
<span class=na>    ns0#getCountryRequest</span><span class=o>:</span><span class=w> </span><span class=s>{</span><span class=w></span>
<span class=na>        ns0#name</span><span class=o>:</span><span class=w> </span><span class=s>attributes.uriParams.id</span><span class=w></span>
<span class=w>    </span><span class=err>}</span><span class=w></span>
<span class=err>}</span><span class=w></span>
</code></pre></div></li> </ul> </li> <li> <p>Ajouter maintenant le composant <strong>Transform Message</strong> pour transformer la réponse SOAP reçue en JSON.</p> </li> <li>Glisser-déplacer les champs provenant du payload <em>getCountryResponse</em> vers l'objet en sortie. Cela devra générer le code suivant: <div class=highlight><pre><span></span><code><span class=err>%dw</span><span class=w> </span><span class=err>2.0</span><span class=w></span>
<span class=err>output</span><span class=w> </span><span class=err>application/json</span><span class=w></span>
<span class=na>ns ns0 http</span><span class=o>:</span><span class=s>//spring.io/guides/gs-producing-web-service</span><span class=w></span>
<span class=err>---</span><span class=w></span>
<span class=err>{</span><span class=w></span>
<span class=na>    capital</span><span class=o>:</span><span class=w> </span><span class=s>payload.body.ns0#getCountryResponse.ns0#country.ns0#capital default &quot;&quot;,</span><span class=w></span>
<span class=na>    name</span><span class=o>:</span><span class=w> </span><span class=s>payload.body.ns0#getCountryResponse.ns0#country.ns0#name default &quot;&quot;,</span><span class=w></span>
<span class=na>    currency</span><span class=o>:</span><span class=w> </span><span class=s>payload.body.ns0#getCountryResponse.ns0#country.ns0#currency default &quot;&quot;,</span><span class=w></span>
<span class=na>    population</span><span class=o>:</span><span class=w> </span><span class=s>payload.body.ns0#getCountryResponse.ns0#country.ns0#population default 0</span><span class=w></span>
<span class=err>}</span><span class=w></span>
</code></pre></div></li> </ol> <h5 id=lancer-les-services><em>Lancer les services</em><a class=headerlink href=#lancer-les-services title="Permanent link">&para;</a></h5> <p>Pour exécuter les deux services dans Anypoint, il faut suivre les étapes suivantes:</p> <ul> <li>Créer une nouvelle configuration d'exécution (<em>Run Configurations...</em>) qu'on appellera <strong>services1and2</strong></li> <li> <p>Sélectionner les deux services <em>tp1</em> et <em>countriesrestservice</em>. Cela devra ressembler à ce qui suit: <center><img src=../img/tp2/runconfig.png width=60%></center></p> </li> <li> <p>Lancer les deux services en cliquant sur <em>Run</em>.</p> </li> </ul> <p>Une fois les deux services lancés, tester la nouvelle fonctionnalité implémentée, en allant sur le navigateur et en testant par exemple: <code>http://localhost:8088/api/countries/Armenia</code>. Le résultat affiché sera ainsi:</p> <p><center><img src=../img/tp2/final.png width=60%></center></p> <h2 id=homework>Homework<a class=headerlink href=#homework title="Permanent link">&para;</a></h2> <div class="admonition note"> <p class=admonition-title>Projet E2</p> <p>Pour la séance de TP prochaine, vous devez réaliser l'étape 2 du projet, qui consiste à:</p> <ul> <li>Terminer les diagrammes de votre entreprise commencés la semaine d'avant.</li> <li>Concevoir et commencer l'implémentation des services nécessaires pour votre PoC. </li> <li>Réfléchir à l'usage des ESB, leur rôle et les stratégies qui y seront implémentées.</li> </ul> </div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2023-11-20T10:57:01+01:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-11-20</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../tp1/ class="md-footer__link md-footer__link--prev" aria-label="Previous: TP1 - Services Web SOAP avec Mule ESB" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> TP1 - Services Web SOAP avec Mule ESB </div> </div> </a> <a href=../tp3/ class="md-footer__link md-footer__link--next" aria-label="Next: TP3 - Orchestration de Services avec Camunda" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> TP3 - Orchestration de Services avec Camunda </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 Lilia Sfaxi </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.092fa1f6.min.js"}</script> <script src=../assets/javascripts/bundle.e3b2bf44.min.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> </body> </html>