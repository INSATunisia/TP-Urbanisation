<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Les Travaux Pratiques du cours Urbanisation des Systèmes d'Information"><meta name=author content="Lilia Sfaxi"><link href=http://INSATunisia.github.io/TP-Urbanisation/tp1/ rel=canonical><link rel=icon href=../img/favicon.ico><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.1.10"><title>TP1 - Services Web SOAP avec Mule ESB - TP Urbanisation des Systèmes d'Information</title><link rel=stylesheet href=../assets/stylesheets/main.d6be258b.min.css><link rel=stylesheet href=../assets/stylesheets/palette.e6a45f82.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Questrial:300,400,400i,700%7CSource+Code+Pro&display=fallback"><style>:root{--md-text-font:"Questrial";--md-code-font:"Source Code Pro"}</style><link rel=stylesheet href=../css/timeago.css><link rel=stylesheet href=../stylesheets/extra.css><link rel=stylesheet href=../stylesheets/links.css><link rel=stylesheet href=../stylesheets/custom.css><script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=amber data-md-color-accent=amber> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#telecharger-pdf class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="TP Urbanisation des Systèmes d'Information" class="md-header__button md-logo" aria-label="TP Urbanisation des Systèmes d'Information" data-md-component=logo> <img src=../img/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> TP Urbanisation des Systèmes d'Information </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> TP1 - Services Web SOAP avec Mule ESB </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=amber data-md-color-accent=amber aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=amber data-md-color-accent=amber aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/INSATunisia/TP-Urbanisation/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> INSATunisia/TP-Urbanisation </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="TP Urbanisation des Systèmes d'Information" class="md-nav__button md-logo" aria-label="TP Urbanisation des Systèmes d'Information" data-md-component=logo> <img src=../img/logo.png alt=logo> </a> TP Urbanisation des Systèmes d'Information </label> <div class=md-nav__source> <a href=https://github.com/INSATunisia/TP-Urbanisation/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> INSATunisia/TP-Urbanisation </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Travaux Pratiques Urbanisation des SI </a> </li> <li class=md-nav__item> <a href=../projet/ class=md-nav__link> Projet </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> TP1 - Services Web SOAP avec Mule ESB <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> TP1 - Services Web SOAP avec Mule ESB </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#telecharger-pdf class=md-nav__link> Télécharger PDF </a> </li> <li class=md-nav__item> <a href=#objectifs-du-tp class=md-nav__link> Objectifs du TP </a> </li> <li class=md-nav__item> <a href=#outils-et-versions class=md-nav__link> Outils et Versions </a> </li> <li class=md-nav__item> <a href=#presentation-des-outils class=md-nav__link> Présentation des outils </a> <nav class=md-nav aria-label="Présentation des outils"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#anypoint-platform class=md-nav__link> Anypoint Platform </a> </li> <li class=md-nav__item> <a href=#mule-esb class=md-nav__link> Mule ESB </a> </li> <li class=md-nav__item> <a href=#anypoint-studio class=md-nav__link> Anypoint Studio </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#creation-dun-service-web-soap-avec-anypoint-studio-et-mule class=md-nav__link> Création d'un service web SOAP avec Anypoint Studio et Mule </a> <nav class=md-nav aria-label="Création d'un service web SOAP avec Anypoint Studio et Mule"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-exposition-dun-service-web-soap-a-partir-dun-fichier-wsdl-existant class=md-nav__link> 1. Exposition d'un service web SOAP à partir d'un fichier WSDL existant </a> </li> <li class=md-nav__item> <a href=#2-test-du-service-web-avec-soap-ui class=md-nav__link> 2. Test du service web avec SOAP UI </a> </li> <li class=md-nav__item> <a href=#3-implementation-du-service class=md-nav__link> 3. Implémentation du service </a> </li> <li class=md-nav__item> <a href=#4-implementation-dune-condition class=md-nav__link> 4. Implémentation d'une condition </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#consultation-dune-base-de-donnees class=md-nav__link> Consultation d'une base de données </a> <nav class=md-nav aria-label="Consultation d'une base de données"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-creation-et-population-de-la-base class=md-nav__link> 1. Création et population de la base </a> </li> <li class=md-nav__item> <a href=#2-modification-du-flux class=md-nav__link> 2. Modification du flux </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#homework class=md-nav__link> Homework </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#telecharger-pdf class=md-nav__link> Télécharger PDF </a> </li> <li class=md-nav__item> <a href=#objectifs-du-tp class=md-nav__link> Objectifs du TP </a> </li> <li class=md-nav__item> <a href=#outils-et-versions class=md-nav__link> Outils et Versions </a> </li> <li class=md-nav__item> <a href=#presentation-des-outils class=md-nav__link> Présentation des outils </a> <nav class=md-nav aria-label="Présentation des outils"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#anypoint-platform class=md-nav__link> Anypoint Platform </a> </li> <li class=md-nav__item> <a href=#mule-esb class=md-nav__link> Mule ESB </a> </li> <li class=md-nav__item> <a href=#anypoint-studio class=md-nav__link> Anypoint Studio </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#creation-dun-service-web-soap-avec-anypoint-studio-et-mule class=md-nav__link> Création d'un service web SOAP avec Anypoint Studio et Mule </a> <nav class=md-nav aria-label="Création d'un service web SOAP avec Anypoint Studio et Mule"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-exposition-dun-service-web-soap-a-partir-dun-fichier-wsdl-existant class=md-nav__link> 1. Exposition d'un service web SOAP à partir d'un fichier WSDL existant </a> </li> <li class=md-nav__item> <a href=#2-test-du-service-web-avec-soap-ui class=md-nav__link> 2. Test du service web avec SOAP UI </a> </li> <li class=md-nav__item> <a href=#3-implementation-du-service class=md-nav__link> 3. Implémentation du service </a> </li> <li class=md-nav__item> <a href=#4-implementation-dune-condition class=md-nav__link> 4. Implémentation d'une condition </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#consultation-dune-base-de-donnees class=md-nav__link> Consultation d'une base de données </a> <nav class=md-nav aria-label="Consultation d'une base de données"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-creation-et-population-de-la-base class=md-nav__link> 1. Création et population de la base </a> </li> <li class=md-nav__item> <a href=#2-modification-du-flux class=md-nav__link> 2. Modification du flux </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#homework class=md-nav__link> Homework </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/INSATunisia/TP-Urbanisation/edit/master/docs/tp1.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>TP1 - Services Web SOAP avec Mule ESB</h1> <p><center> <img alt="Web Services" src=../img/ws.png> </center></p> <h2 id=telecharger-pdf>Télécharger PDF<a class=headerlink href=#telecharger-pdf title="Permanent link">&para;</a></h2> <p><a href=../tp1.pdf><img alt="Download TP1" src=../img/pdf.png></a></p> <h2 id=objectifs-du-tp>Objectifs du TP<a class=headerlink href=#objectifs-du-tp title="Permanent link">&para;</a></h2> <p>Création et consommation de web services SOAP en utilisant l'outil Anypoint Studio.</p> <h2 id=outils-et-versions>Outils et Versions<a class=headerlink href=#outils-et-versions title="Permanent link">&para;</a></h2> <ul> <li><a href=https://www.mulesoft.com/lp/dl/anypoint-mule-studio>Anypoint Studio 7 and Mule ESB 4</a></li> <li><a href=https://dev.mysql.com/downloads/ >MySQL</a> Version <em>latest</em></li> <li><a href=https://www.soapui.org/downloads/soapui.html>SOAPUI</a> (Open Source) Version 5.7.0</li> <li><a href=https://code.visualstudio.com/Download>VSCode</a> Version <em>latest</em></li> </ul> <h2 id=presentation-des-outils>Présentation des outils<a class=headerlink href=#presentation-des-outils title="Permanent link">&para;</a></h2> <h3 id=anypoint-platform>Anypoint Platform<a class=headerlink href=#anypoint-platform title="Permanent link">&para;</a></h3> <p><a href=https://www.mulesoft.com/platform/enterprise-integration>Anypoint</a> est une plateforme développée par l’entreprise Mulesoft qui offre les outils nécessaires pour la gestion d’APIs et l'intégration de services. Grâce à Anypoint, Mulesoft est classée par Gartner dans son Magic Quadrant dans la rubrique “Enterprise Integration Platform as a Service” de Décembre 2022 parmi les leaders du marché.</p> <p><img alt="Magic Quadrant: Enterprise Integration Platform as a Service" src=../img/tp1/gartner.png></p> <h3 id=mule-esb>Mule ESB<a class=headerlink href=#mule-esb title="Permanent link">&para;</a></h3> <p>Mule, le runtime engine d'Anypoint Platform, est un ESB (enterprise service bus) léger basé sur Java ainsi qu'une plateforme d'intégration qui permet aux développeurs de connecter des applications rapidement et facilement afin qu'elles puissent échanger des données. Cela facilite l'intégration des systèmes existants, quelles que soient les technologies utilisées par les applications, notamment JMS, Web Services, JDBC, HTTP, etc. Cet ESB, déployable n'importe où, qui intègre et orchestre les événements en temps réel ou par lots, dispose d'une connectivité universelle.</p> <p>Mule ESB propose les services suivants:</p> <ul> <li>Création et hébergement de services</li> <li>Médiation de services</li> <li>Routage des messages</li> <li>Transformation des données</li> </ul> <h3 id=anypoint-studio>Anypoint Studio<a class=headerlink href=#anypoint-studio title="Permanent link">&para;</a></h3> <p>Anypoint Studio fournit une interface graphique de développement pour implémenter, compiler, tester et publier des services Web, des services de données et des routes de messages.</p> <!-- # Création d'un service web SOAP avec Spring Boot et VSCode

Nous allons commencer par créer un premier service web simple, pour tester son déploiement et intégration sur l'ESB plus tard. Nous utilisons pour cela Spring Boot et VSCode (mais on aurait pu utiliser n'importe quel autre langage, framework ou IDE).

Ce web service permet de créer un service web SOAP avec Spring Boot, qui prend en entrée un pays (_Spain_, _Poland_ ou _United Kingdom_), et nous donne sa population, sa capitale et sa monnaie. Vous trouverez tous les détails et explications du code dans le tutoriel suivant: `https://spring.io/guides/gs/producing-web-service`.

* Commencer par cloner le repository git suivant : `https://github.com/spring-guides/gs-producing-web-service`
* Sur votre répertoire local, ouvrir le projet avec VSCode (ou tout autre IDE de votre choix).
* Je vous donne ici les étapes à suivre pour lancer le service avec Maven ([Maven 3.5+](https://maven.apache.org/download.cgi) est requis). Si vous préférez gradle, vous trouverez les détails d'exécution dans le tutoriel d'origine. 
  * Positionnez-vous sous le répertoire `complete`
  * Lancer votre service :
    * Si vous êtes sur Linux/Mac, exécuter la commande : `./mvnw spring-boot:run`
    * Si vous êtes sur Windows, exécuter : `mvnw.cmd spring-boot:run`

Si le service est correctement lancé, vous trouverez un affichage similaire au suivant:


<center>
<img width="700pt" src="../img/tp1/serviceok.png">
</center>

Pour tester votre service, il est recommandé d'utiliser une application comme SOAPUI. Pour cela: 

* Vérifier que votre web service tourne bien et que votre WSDL est généré en tapant sur votre navigateur: `http://localhost:8080/ws/countries.wsdl`. Un WSDL devrait s'afficher correctement.
* Ouvrir SOAPUI et créer un nouveau projet SOAP.
* Lui donner un nom (par exemple _MySOAPService_) et un WSDL initial: `http://localhost:8080/ws/countries.wsdl`
* Cliquer sur _Request 1_ qui se trouve sous l'opération _getCountry_
* Une fenêtre s'affiche avec le fichier XML de la requête SOAP. Vous n'avez qu'à remplacer le ? par _Spain_, puis exécuter le web service. La réponse s'affichera sous la forme d'un fichier XML (SOAP Response) contenant les informations sur le pays donné en entrée, comme suit:

<center>
<img width="700pt" src="../img/tp1/soapresponse.png">
</center>

 --> <h2 id=creation-dun-service-web-soap-avec-anypoint-studio-et-mule>Création d'un service web SOAP avec Anypoint Studio et Mule<a class=headerlink href=#creation-dun-service-web-soap-avec-anypoint-studio-et-mule title="Permanent link">&para;</a></h2> <p>Il est possible de créer un service web SOAP avec Anypoint en utilisant les connecteurs fournis, et très peu de lignes de code. Nous allons simuler le comportement du service web décrit dans le tutoriel suivant: <code>https://spring.io/guides/gs/producing-web-service</code>.</p> <h3 id=1-exposition-dun-service-web-soap-a-partir-dun-fichier-wsdl-existant>1. Exposition d'un service web SOAP à partir d'un fichier WSDL existant<a class=headerlink href=#1-exposition-dun-service-web-soap-a-partir-dun-fichier-wsdl-existant title="Permanent link">&para;</a></h3> <p>Nous récupérons d'abord le fichier WSDL du service. Il est possible de générer un fichier WSDL avec des outils tel que Eclipse, mais nous allons nous contenter d'en utiliser un qui est prêt. Vous trouverez le fichier wsdl à télécharger ici : <a href=../files/countriesService.wsdl.xml><img alt="Download WSDL" src=../img/download.png></a>.</p> <p>Le web service SOAP que nous allons créer prend en entrée un pays (nous accepterons pour le moment <em>Spain</em> ou <em>Poland</em>), et nous donne sa population, sa capitale et sa monnaie. Nous allons suivre les étapes suivantes pour créer ce service avec Anypoint Studio. </p> <ul> <li>Créer un nouveau Mule Project, qu'on appellera TP1. Dans la fenêtre de création : <ul> <li>Indiquer que le runtime est bien Mule Server 4.4.0</li> <li>Installer le runtime supplémentaire suivant: <em>Anypoint APIkit SOAP Plugin</em></li> <li>Indiquer que le wsdl est le fichier que vous venez de télécharger. Pour cela, cliquer sur <em>"Import RAML from local file"</em> et choisir le fichier wsdl. Vérifier que le service et le port s'affichent bien comme suit:</li> </ul> </li> </ul> <p><center><img style src=../img/tp1/service-port.png></center></p> <p>Une fois le projet créé, la fenêtre suivante va apparaître:</p> <p><center><img style src=../img/tp1/initial-screen.png></center></p> <p>En cliquant sur <strong>Listener</strong>, vous pouvez trouver (en bas de l'écran) les informations de base du service SOAP exposé, qui est décrit par votre wsdl, tel qu'indiqué dans la figure suivante:</p> <p><center><img style src=../img/tp1/service-info.png></center></p> <p>Le path (1), domaine et port (2) permettent de représenter l'URL du service qui sera exposé. Pour tester cela, lancer le service, en faisant un clic-droit sur la fenêtre principale, et en choisissant: <em>Run project tp1</em>.</p> <div class="admonition tip"> <p class=admonition-title>Remarque</p> <p>Prenez soin d'utiliser une version de JDK entre 8 et 12, car ce sont celles compatibles avec le serveur Mule 4.4.</p> </div> <p>Une fois le service lancé, vérifiez bien que le wsdl est exposé, sur l'URL: <code>http://localhost:8081/CountriesPortService/CountriesPortSoap11?wsdl</code></p> <h3 id=2-test-du-service-web-avec-soap-ui>2. Test du service web avec SOAP UI<a class=headerlink href=#2-test-du-service-web-avec-soap-ui title="Permanent link">&para;</a></h3> <p>Nous allons maintenant tester notre service web. Comme vous le savez certainement, pour tester un service web SOAP, il faut écrire une SOAP Request (en XML), pour obtenir un SOAP Response de la part du service. Pour cela, nous utilisons un outil de test léger, appelé SOAP UI. </p> <p>Lancer SOAP UI, et créer un nouveau projet SOAP. Ensuite:</p> <ul> <li>Nommer le projet TP1 par exemple.</li> <li>Coller l'URL du WSDL dans le champs <em>Initial WSDL</em></li> <li>Dans le projet créé, naviguer vers <em>TP1 -&gt; CountriesPortSoap11 -&gt; getCountry -&gt; Request1</em> et double cliquer dessus. Une fenêtre s'ouvre, comme suit:</li> </ul> <p><center><img style src=../img/tp1/soapui-initial.png></center></p> <p>Pour tester le service, il suffit de remplacer le <strong>?</strong> dans la balise <gs:name>?</gs:name> par le nom d'un pays, par exemple <em>Spain</em>. Lancer le service en cliquant sur la flèche verte. Que constatez-vous?</p> <p>Bien entendu, rien ne va vraiment se passer, car le service n'a pas encore été implémenté. Tout ce qu'on a fait, c'est de donner une spécification vide. La réponse qui s'affiche est un fichier XML affichant une erreur semblable à la suivante: <em>Operation [getCountry:\soapkit-config] not implemented</em>.</p> <p>Nous allons montrer dans ce qui suit comment corriger cette erreur, pour afficher les informations d'un pays donné en paramètre.</p> <h3 id=3-implementation-du-service>3. Implémentation du service<a class=headerlink href=#3-implementation-du-service title="Permanent link">&para;</a></h3> <p>Le deuxième rectangle dans la fenêtre principale de Anypoint permet de définir le comportement du service suite à la réception d'un SOAP Request. Il contient pour le moment un seul composant : <em>Transform Message</em>. En cliquant dessus, vous retrouverez dans l'output le message d'erreur qui vous a été retourné précédemment. Ceci veut dire que le comportement du service n'a pas été implémenté.</p> <p>Pour le faire, nous allons suivre les étapes suivantes:</p> <ul> <li>Cliquer sur le composant <em>Transform Message</em>. Dans ses propriétés, trois colonnes sont affichées tel que représenté dans la figure suivante:</li> </ul> <p><center><img style src=../img/tp1/transform_initial.png></center></p> <pre><code>- Input:  le squelette de la SOAP Request
- Output (graphique): le squelette de la SOAP Response.
- Output (code): le code XML correspondant à la SOAP Response.
</code></pre> <ul> <li>Supprimer le bloc <strong>Soap#Fault</strong> du code XML. </li> <li>Glisser la variable <strong>name</strong> de l'Input vers la variable <strong>name</strong> de l'output graphique. Observez comment le code XML a également changé.</li> <li>Double cliquer sur le champs <strong>population</strong> dans la colonne dde l'output graphique. Le code approprié sera généré dans le XML. Remplacer la valeur <strong>null</strong> par la valeur de la population en Espagne (47420000 à ce jour). Faites de même pour indiquer la capitale (<em>Madrid</em>) et la monnaie (<em>EUR</em>).</li> </ul> <p>Le résultat devra ressembler à ce qui suit:</p> <p><center><img style src=../img/tp1/transform_spain.png></center></p> <p>Relancer le service si vous l'avez fermé, et observez le résultat sur SOAPUI. Cela a l'air de bien marcher!</p> <p>Cela dit, le service donnera toujours le même résultat (population/capitale/monnaie), quelque soit l'input saisi dans pays. Nous allons essayer dans ce qui suit de le rendre un peu plus flexible, toujours sans écrire une ligne de code!</p> <h3 id=4-implementation-dune-condition>4. Implémentation d'une condition<a class=headerlink href=#4-implementation-dune-condition title="Permanent link">&para;</a></h3> <p>Pour implémenter une condition dans notre service, qui donne un output différent selon l'entrée qui lui est donnée, nous allons suivre les étapes suivantes:</p> <ul> <li>Nous allons d'abord créer une variable <em>country</em>, qu'on va alimenter à partir de l'input. Pour cela:<ul> <li>Glisser le composant <em>Set Variable</em> de la palette juste avant <em>Transform Message</em></li> <li>Donner le nom <em>country</em> à la variable.</li> <li>Dans le champ <em>Value</em>, cliquer sur le bouton <img alt="Expression Formula" src=../img/tp1/fx.png>.</li> <li>Écrire quelque chose dans le champ qui s'affiche (par exemple <em>country</em>)</li> <li>Cliquer ensuite sur le bouton <img alt="Value Map" src=../img/tp1/map.png> pour mapper l'entrée à la variable. </li> <li>Dans la fenêtre qui s'affiche, glisser l'élément <em>name</em> de la requête vers la chaine String (dans l'output graphique). La valeur que vous avez saisi sera écrasée par l'expression du nom en entrée. </li> <li>Cliquer sur <em>Done</em></li> </ul> </li> <li>À partir de la palette, glisser le composant <em>Choice</em> avant <em>Transform Message</em></li> <li>Glisser ensuite <em>Transform Message</em> dans le <em>When</em> </li> <li>Cliquer sur le <em>When</em> pour définir la condition.<ul> <li>Dans le champ <em>Expression</em>, cliquer sur le bouton <img alt="Expression Formula" src=../img/tp1/fx.png>, puis taper <strong>directement</strong> la condition: <code>vars.country == 'Spain'</code></li> </ul> </li> <li>Pour ajouter une autre condition (un <em>else if</em>), glisser un nouveau <em>Transform Message</em> de la palette vers l'extrémité droite du box <em>Choice</em>. Refaire ensuite les opérations précédentes pour un autre pays, tel que la Tunisie.</li> <li>Dans le box <em>Default</em>, créer un message d'erreur qui ressemble à celui qu'on avait à la création du service, qui indique que le pays donné en entrée n'est pas pris en charge.</li> </ul> <p>Lancer le service, et vérifier avec SOAPUI que toutes les conditions sont bien prises en compte.</p> <div class="admonition warning"> <p class=admonition-title>Attention</p> <p>Prenez des imprim-écrans dès que a marche, vous en aurez besoin dans le rapport!</p> </div> <h2 id=consultation-dune-base-de-donnees>Consultation d'une base de données<a class=headerlink href=#consultation-dune-base-de-donnees title="Permanent link">&para;</a></h2> <p>Nous allons montrer dans ce qui suit les étapes nécessaires pour configurer et faire appel à une base de données. Nous allons utiliser MySQL dans notre exemple.</p> <h3 id=1-creation-et-population-de-la-base>1. Création et population de la base<a class=headerlink href=#1-creation-et-population-de-la-base title="Permanent link">&para;</a></h3> <p>Pour cela:</p> <ul> <li>Créer une nouvelle base de données avec MySQL. On l'appellera Countries.</li> <li>Lancer le script SQL suivant pour créer la table countries populée avec plusieurs exemples de pays: <a href=../files/countries.sql><img alt="Script SQL" src=../img/tp1/script.png></a></li> </ul> <p>Consulter votre base pour voir son contenu et sa structure.</p> <h3 id=2-modification-du-flux>2. Modification du flux<a class=headerlink href=#2-modification-du-flux title="Permanent link">&para;</a></h3> <p>Modifier le flux <em>getCountry</em> de façon à ce qu'il ressemble à l'image suivante:</p> <p><center><img style src=../img/tp1/db_flow.png></center></p> <ul> <li><strong>Set Variable</strong> permet de créer une variable <em>country</em> qui saisit l'entrée dans la SOAP Request.</li> <li><strong>Logger</strong> permet d'afficher le contenu de la variable saisie sur la console, sous la forme: <em>"Pays: &lt;nom_pays>"</em>.</li> <li><strong>Select</strong> contient la requête de sélection de la base de données, filtrée par le pays donné en entrée.</li> <li><strong>Transform Message</strong> retourne dans la SOAP Response, les informations du pays en entrée, extraites de la base de données.</li> </ul> <p>Le résultat attendu ressemble au suivant:</p> <p><center><img style src=../img/tp1/db_result.png></center></p> <h2 id=homework>Homework<a class=headerlink href=#homework title="Permanent link">&para;</a></h2> <div class="admonition note"> <p class=admonition-title>Projet: Étape 1</p> <p>Pour la séance de TP prochaine, vous devez réaliser l'étape 1 du projet, qui consiste à:</p> <ul> <li>Trouver le concept de votre entreprise (nom, logo, métier, et départements)</li> <li>Réaliser le tutoriel : Archisurance (voir les supports du projet)</li> <li>Commencer à réaliser les diagrammes de votre propre entreprise.</li> </ul> </div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2023-09-25T22:24:50+01:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-09-25</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../projet/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Projet" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Projet </div> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 Lilia Sfaxi </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.092fa1f6.min.js"}</script> <script src=../assets/javascripts/bundle.e3b2bf44.min.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> </body> </html>